config.tx_extbase {
    persistence {
        classes {
            Tx_Extbase_Domain_Model_FrontendUser {
                subclasses {
                    Tx_Ajaxlogin_Domain_Model_User = Tx_Ajaxlogin_Domain_Model_User
                }
            }
            Tx_Ajaxlogin_Domain_Model_User {
                mapping {
                    tableName = fe_users
                    columns {
                    	tx_ajaxlogin_forgotHash.mapOnProperty = forgotHash
                    	tx_ajaxlogin_forgotHashValid.mapOnProperty = forgotHashValid
                    }
                }
            }
        }
    }
}

plugin.tx_ajaxlogin {
    settings {
    	widgetTypeNum = {$plugin.tx_ajaxlogin.settings.widgetTypeNum}
    	validation {
    		User {
    			username = {$plugin.tx_ajaxlogin.settings.validation.User.username}
    			password = {$plugin.tx_ajaxlogin.settings.validation.User.password}
    		}
    	}
    }
    persistence {
        storagePid = {$plugin.tx_ajaxlogin.persistence.storagePid}
    }
    view {
        templateRootPath = {$plugin.tx_ajaxlogin.view.templateRootPath}
        partialRootPath = {$plugin.tx_ajaxlogin.view.partialRootPath}
        layoutRootPath = {$plugin.tx_ajaxlogin.view.layoutRootPath}
    }
}

tx_ajaxlogin_widget = PAGE
tx_ajaxlogin_widget {
	typeNum = {$plugin.tx_ajaxlogin.settings.widgetTypeNum}
	config.disableAllHeaderCode = 1
	config.no_cache = 1
	config.stat = 0
	
	10 < tt_content.list.20.ajaxlogin_widget
}

effr3gt45plugin.tx_ajaxlogin {
	profilePid = TEXT
	profilePid.value = 3
	
	storagePid = TEXT
	storagePid.value = 11
	
	minimumPasswordLength = TEXT
	minimumPasswordLength.value = 8
	
	mailFrom = TEXT
	mailFrom.value = info@typo3.org
	
	mailFromName = TEXT
	mailFromName.value = typo3.org
	
	resetLinkValidHours = TEXT
	resetLinkValidHours.value = 24
	
	resetLinkValidStrftimeFormat = TEXT
	resetLinkValidStrftimeFormat.value = %c
}

page.jsInline.98987 = COA
page.jsInline.98987{
	10 = COA
	10 {
		10 = COA
		10 {
			10 = TEXT
			10 {
				typolink.parameter.data = leveluid:0
				typolink.additionalParams.cObject = COA
				typolink.additionalParams.cObject {
					10 = TEXT
					10.value = info
					10.wrap = &tx_ajaxlogin_widget[action]=|
					20 = TEXT
					20.value = User
					20.wrap = &tx_ajaxlogin_widget[controller]=|
					30 = TEXT
					30.value = {$plugin.tx_ajaxlogin.settings.widgetTypeNum}
					30.wrap = &type=|
				}
				typolink.returnLast = url
				wrap = info:'|'
			}
			
			20 < .10
			20 {
				typolink.additionalParams.cObject.10.value = login
				wrap = ,login:'|'
			}
			
			30 < .10
			30 {
				typolink.additionalParams.cObject.10.value = authenticate
				wrap = ,authenticate:'|'
			}
			
			40 < .10
			40 {
				typolink.additionalParams.cObject.10.value = logout
				wrap = ,logout:'|'
			}
			
			50 < .10
			50 {
				typolink.additionalParams.cObject.10.value = new
				wrap = ,'new':'|'
			}
			
			60 < .10
			60 {
				typolink.additionalParams.cObject.10.value = create
				wrap = ,create:'|'
			}
			
			70 < .10
			70 {
				typolink.additionalParams.cObject.10.value = forgotPassword
				wrap = ,forgotPassword:'|'
			}
			
			80 < .10
			80 {
				typolink.additionalParams.cObject.10.value = resetPassword
				wrap = ,resetPassword:'|'
			}
			
			90 < .10
			90 {
				typolink.additionalParams.cObject.10.value = updatePassword
				wrap = ,updatePassword:'|'
			}
			
			wrap = User:{|}
		}
		
		20 = COA
		20 {
			10 = TEXT
			10 {
				typolink.parameter.data = leveluid:0
				typolink.additionalParams.cObject = COA
				typolink.additionalParams.cObject {
					10 = TEXT
					10.value = tx_ajaxlogin_utility
					10.wrap = &eID=|
					20 = TEXT
					20.value = createEncryptionkey
					20.wrap = &tx_ajaxlogin_utility[action]=|
				}
				typolink.returnLast = url
				wrap = createEncryptionkey:'|'
			}
			
			wrap = ,Utility:{|}
		}
		
		wrap = api:{|}
	}
	
	20 = TEXT
	20.value = #ajaxlogin
	20.wrap = ,placeholder: '|'
	
	30 = TEXT
	30.value = {$plugin.tx_ajaxlogin.persistence.storagePid}
	30.wrap = ,storagePid:|
	
	40 = TEXT
	40.value = #login-status
	40.wrap = ,statusLabel:'|'
	
	50 = TEXT
	50.value = #tx-ajaxlogin-editPassword
	50.wrap = ,editPasswordForm:'|'
	
	51 = TEXT
	51.value = .tx-ajaxlogin-profile
	51.wrap = ,profileSection:'|'
	
	60 = COA
	60 {
		10 = TEXT
		10.data = LLL:EXT:ajaxlogin/Resources/Private/Language/locallang.xml:status_authenticated
		10.wrap = status_authenticated:'|'
		
		20 = TEXT
		20.data = LLL:EXT:ajaxlogin/Resources/Private/Language/locallang.xml:status_unauthorized
		20.wrap = ,status_unauthorized:'|'
	
		wrap = ,ll:{|}
	}
	
	70 = COA
	70 {
		10 = COA
		10 {
			10 = TEXT
			10.data = path:EXT:rsaauth/resources/jsbn/jsbn.js
			10.wrap = '|'
			
			20 < .10
			20.data = path:EXT:rsaauth/resources/jsbn/prng4.js
			20.wrap = ,'|'
			
			30 < .20
			30.data = path:EXT:rsaauth/resources/jsbn/rng.js
			
			40 < .20
			40.data = path:EXT:rsaauth/resources/jsbn/rsa.js
			
			50 < .20
			50.data = path:EXT:rsaauth/resources/jsbn/base64.js
		
			wrap = rsaauth:[|]
		}
	
		wrap = ,scripts:{|}
	}
	
	80 = COA
	80 {
		10 = COA
		10 {
			10 = TEXT
			10.value = {$plugin.tx_ajaxlogin.settings.validation.User.username}
			10.wrap = username:|
			
			20 = TEXT
			20.value = {$plugin.tx_ajaxlogin.settings.validation.User.password}
			20.wrap = ,password:|
			
			wrap = User:{|}
		}
	
		wrap = ,validation:{|}
	}
	
	wrap = var tx_ajaxlogin = {|};
}

page.includeJSFooter.tx-ajaxlogin = EXT:ajaxlogin/Resources/Public/JavaScript/Ajaxlogin.js